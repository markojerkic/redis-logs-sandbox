<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <title>Redis Logs</title>
    <script
      src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"
      integrity="sha384-/TgkGk7p307TH7EXJDuUlgG3Ce1UVolAOFopFekQkkXihi5u/6OCvVKyz1W+idaz"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/htmx-ext-ws@2.0.4"
      integrity="sha384-1RwI/nvUSrMRuNj7hX1+27J8XDdCoSLf0EjEyF69nacuWyiJYoQ/j39RT1mSnd2G"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="/css/index.css" />
  </head>

  <body hx-boost="true">
    <div id="scroll-lock-indicator" class="scroll-lock-active">
      Auto-scroll: ON
    </div>
    <div class="log-body">
      <script src="/js/log-list/log-actions.js"></script>
      <a class="header" href="/">
        <div class="container">
          <h1>Redis Pub/Sub Logs</h1>
        </div>
      </a>
      <div class="log-container">
        <div id="log-list" th:fragment="loglist">
          <span
            th:if="${beforeId != null}"
            th:hx-get="@{/{appName}(appName=${appName}, before=${beforeId})}"
            hx-trigger="intersect once threshold:0.5"
            hx-swap="outerHTML show:bottom"
            hx-select="#log-list>*"
          ></span>
          <pre
            th:each="log : ${logs}"
            th:class="'log ' + ${log.level}"
            th:fragment="logline"
            th:id="'log-' + ${log.id}"
            th:data-log-id="${log.id}"
            th:data-app-name="${log.app?.appName}"
            th:data-instance-id="${log.app?.instanceId}"
          ><span class="log-content" th:text="${log.id}">Message</span><button
              class="log-copy-btn"
              title="Copy link to line"
              onclick="handleCopyButtonClick(event)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                width="16"
                height="16"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"
                />
              </svg>
            </button></pre>
          <span
            th:if="${afterId != null}"
            th:text="'After id: ' + ${afterId}"
          ></span>
        </div>
      </div>
    </div>
    <script src="/js/log-list/scroll-to-bottom.js" type="module"></script>
    <div
      hx-ext="ws"
      th:ws-connect="@{/ws/logs/{appName}(appName=${appName})}"
    ></div>
  </body>
</html>
